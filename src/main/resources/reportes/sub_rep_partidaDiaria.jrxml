<?xml version="1.0" encoding="UTF-8"?>
<!-- Created with Jaspersoft Studio version 6.21.5.final using JasperReports Library version 6.21.5-74d586df47b25dbd05bd0957999819196e59934a  -->
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="sub_rep_partidaDiaria" pageWidth="595" pageHeight="150" whenNoDataType="NoPages" columnWidth="575" leftMargin="0" rightMargin="20" topMargin="0" bottomMargin="0" isFloatColumnFooter="true" uuid="4406713d-a6f8-4482-9755-32353b0e8919">
	<property name="com.jaspersoft.studio.data.sql.tables" value=""/>
	<property name="com.jaspersoft.studio.data.defaultdataadapter" value="DataAdapter.jrdax"/>
	<property name="com.jaspersoft.studio.property.dataset.dialog.DatasetDialog.sash.w1" value="949"/>
	<property name="com.jaspersoft.studio.property.dataset.dialog.DatasetDialog.sash.w2" value="37"/>
	<parameter name="CODIGO_PADRE" class="java.lang.String">
		<parameterDescription><![CDATA[id de la cuenta padre general]]></parameterDescription>
	</parameter>
	<parameter name="FECHA" class="java.sql.Date"/>
	<queryString language="SQL">
		<![CDATA[WITH RECURSIVE descendientes AS (
    -- Nivel inicial: cuentas cuyo padre es el parámetro
    SELECT 
        c.id_cuenta_contable AS id_hijo,
        c.codigo AS codigo_hijo,
        c.nombre AS nombre_hijo,
        c.id_padre AS id_padre
    FROM cuenta_contable c
    WHERE c.id_padre = (SELECT id_cuenta_contable FROM cuenta_contable WHERE codigo = $P{CODIGO_PADRE})

    UNION ALL

    -- Recursión: traer hijos de los hijos
    SELECT 
        c.id_cuenta_contable AS id_hijo,
        c.codigo AS codigo_hijo,
        c.nombre AS nombre_hijo,
        c.id_padre AS id_padre
    FROM cuenta_contable c
    INNER JOIN descendientes d ON c.id_padre = d.id_hijo
)
SELECT 
    t.id_transaccion,
    c_padre.codigo AS codigo_padre,
    c_padre.nombre AS cuenta_padre,
    d.codigo_hijo AS codigo_hijo,
    d.nombre_hijo AS cuenta_hijo,
    SUM(pd.monto) AS monto
FROM descendientes d
INNER JOIN partida_diaria_detalle pd 
    ON pd.id_cuenta_contable = d.id_hijo
INNER JOIN transaccion t 
    ON t.id_transaccion = pd.id_transaccion
INNER JOIN cuenta_contable c_padre
    ON c_padre.codigo = $P{CODIGO_PADRE}  -- referencia al superior
WHERE DATE(t.fecha) = $P{FECHA}
GROUP BY t.id_transaccion, c_padre.codigo, c_padre.nombre, d.codigo_hijo, d.nombre_hijo
ORDER BY t.id_transaccion, d.codigo_hijo
]]>
	</queryString>
	<field name="id_transaccion" class="java.lang.Integer">
		<property name="com.jaspersoft.studio.field.name" value="id_transaccion"/>
		<property name="com.jaspersoft.studio.field.label" value="id_transaccion"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="transaccion"/>
	</field>
	<field name="codigo_padre" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.name" value="codigo_padre"/>
		<property name="com.jaspersoft.studio.field.label" value="codigo_padre"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="cuenta_contable"/>
	</field>
	<field name="cuenta_padre" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.name" value="cuenta_padre"/>
		<property name="com.jaspersoft.studio.field.label" value="cuenta_padre"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="cuenta_contable"/>
	</field>
	<field name="codigo_hijo" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.name" value="codigo_hijo"/>
		<property name="com.jaspersoft.studio.field.label" value="codigo_hijo"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="cuenta_contable"/>
	</field>
	<field name="cuenta_hijo" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.name" value="cuenta_hijo"/>
		<property name="com.jaspersoft.studio.field.label" value="cuenta_hijo"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="cuenta_contable"/>
	</field>
	<field name="monto" class="java.math.BigDecimal">
		<property name="com.jaspersoft.studio.field.name" value="monto"/>
		<property name="com.jaspersoft.studio.field.label" value="monto"/>
	</field>
	<detail>
		<band height="18" splitType="Stretch">
			<property name="com.jaspersoft.studio.unit.height" value="px"/>
			<textField>
				<reportElement x="0" y="0" width="80" height="18" uuid="2da86597-463d-406a-beec-b31999961f58"/>
				<textElement textAlignment="Left"/>
				<textFieldExpression><![CDATA[$F{codigo_hijo}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="280" y="0" width="80" height="18" uuid="1989ee1c-ea83-4ce2-a1b7-c508f48961f3">
					<property name="com.jaspersoft.studio.unit.width" value="px"/>
				</reportElement>
				<textElement textAlignment="Center"/>
				<textFieldExpression><![CDATA[$F{monto}.compareTo(BigDecimal.ZERO) == 0 ?"" : "$"+$F{monto}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="80" y="0" width="100" height="18" uuid="41d31167-f3d1-4e80-a887-e4167eebfce6"/>
				<textFieldExpression><![CDATA[$F{cuenta_hijo}]]></textFieldExpression>
			</textField>
			<line>
				<reportElement x="-1" y="0" width="1" height="18" uuid="90bac240-7261-4a28-b9a9-24c6e582056d">
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
				</reportElement>
			</line>
			<line>
				<reportElement x="79" y="0" width="1" height="18" uuid="acca8a6d-c1dc-4ca0-a175-d26fc1076153">
					<property name="com.jaspersoft.studio.unit.x" value="px"/>
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
				</reportElement>
			</line>
			<line>
				<reportElement x="279" y="0" width="1" height="18" uuid="ba0c1fb0-2099-4504-8328-aed6c44a36e4">
					<property name="com.jaspersoft.studio.unit.x" value="px"/>
					<property name="com.jaspersoft.studio.unit.y" value="px"/>
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
				</reportElement>
			</line>
			<line>
				<reportElement x="539" y="0" width="1" height="18" uuid="d48c95a3-3d0f-4e38-90da-1f8bebe29757">
					<property name="com.jaspersoft.studio.unit.x" value="px"/>
					<property name="com.jaspersoft.studio.unit.y" value="px"/>
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
				</reportElement>
			</line>
			<line>
				<reportElement x="359" y="0" width="1" height="18" uuid="e5ae4065-1b3c-47de-84a9-8c4b4a6616d1">
					<property name="com.jaspersoft.studio.unit.x" value="px"/>
					<property name="com.jaspersoft.studio.unit.y" value="px"/>
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
				</reportElement>
			</line>
			<line>
				<reportElement x="459" y="0" width="1" height="18" uuid="df85ad57-1f47-440c-8c1b-18185bc8a122">
					<property name="com.jaspersoft.studio.unit.x" value="px"/>
					<property name="com.jaspersoft.studio.unit.y" value="px"/>
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
				</reportElement>
			</line>
			<frame>
				<reportElement x="0" y="0" width="539" height="18" uuid="8b27f0b7-abf0-4e6f-a630-effd41db3283">
					<property name="com.jaspersoft.studio.unit.x" value="px"/>
					<property name="com.jaspersoft.studio.unit.y" value="px"/>
					<property name="com.jaspersoft.studio.unit.width" value="px"/>
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
				</reportElement>
				<box>
					<pen lineStyle="Solid"/>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
			</frame>
		</band>
	</detail>
</jasperReport>
